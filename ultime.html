<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dashboard Immobilier Ultime</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
<style>
  .carousel-inner img { max-height: 200px; object-fit: cover; }
</style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

<!-- Navbar -->
<nav class="main-header navbar navbar-expand navbar-white navbar-light">
  <span class="navbar-brand">ğŸ  Dashboard Immobilier Ultime</span>
</nav>



<!-- Content -->
<div class="content-wrapper p-3">

  <!-- Stats -->
  <div class="row mb-3" id="statsRow"></div>

  <!-- Formulaire -->
  <div class="card mb-4 p-3">
    <h5>â• Ajouter une annonce</h5>
    <form id="annonceForm" autocomplete="off">
      <div class="row g-3">
        <div class="col-md-6"><input type="text" id="titre" class="form-control" placeholder="Titre" required></div>
        <div class="col-md-3"><input type="number" id="prix" class="form-control" placeholder="Prix ($)" required></div>
        <div class="col-md-3"><input type="text" id="ville" class="form-control" placeholder="Ville" required></div>
        <div class="col-md-3"><input type="number" id="chambres" class="form-control" placeholder="Chambres" required></div>
        <div class="col-md-3"><input type="number" id="sdb" class="form-control" placeholder="Salles de bains" required></div>
        <div class="col-md-3"><input type="number" id="cuisine" class="form-control" placeholder="Cuisine" required></div>
        <div class="col-md-3"><input type="date" id="date" class="form-control" required></div>
        <div class="col-md-6"><input type="text" id="nomProprietaire" class="form-control" placeholder="Nom PropriÃ©taire" required></div>

        <div class="col-md-6">
        <input type="file" id="images" class="form-control" accept="image/*" multiple required />
      </div>
      <div class="col-md-12">
        <input type="file"id="imgProprietaire" class="form-control" accept="image/*" required />
      </div>
      
      </div>

      <button type="submit" class="btn btn-primary mt-3">Publier</button>
      
    </form>
  </div>

  <!-- Annonces -->
  <div class="row" id="annoncesList"></div>

  <!-- Interactions -->
  <div class="card mt-4 p-3">
    <h5>ğŸ“‹ Interactions clients</h5>
    <table class="table table-bordered" id="tableInteractions">
      <thead>
        <tr><th>ID</th><th>Annonce</th><th>Type</th><th>Date/Heure</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>

<script>
const adminPhone = "0897653728";
let annonces = JSON.parse(localStorage.getItem("annonces")) || [];
let interactions = JSON.parse(localStorage.getItem("interactions")) || [];

// ---------------- Stats ----------------
function renderStats(){
  const nbAnnonces = annonces.length;
  const nbProprietaires = [...new Set(annonces.map(a=>a.nomProprietaire))].length;
  const nbWhatsApp = interactions.filter(i=>i.type==="whatsapp").length;
  const nbAppels = interactions.filter(i=>i.type==="appel").length;
  const nbLikes = interactions.filter(i=>i.type==="like").length;
  document.getElementById("statsRow").innerHTML = `
    <div class="col-lg-3 col-6"><div class="small-box bg-info"><div class="inner"><h3>${nbAnnonces}</h3><p>Annonces</p></div><div class="icon"><i class="fas fa-building"></i></div></div></div>
    <div class="col-lg-3 col-6"><div class="small-box bg-success"><div class="inner"><h3>${nbProprietaires}</h3><p>PropriÃ©taires</p></div><div class="icon"><i class="fas fa-user"></i></div></div></div>
    <div class="col-lg-2 col-6"><div class="small-box bg-warning"><div class="inner"><h3>${nbWhatsApp}</h3><p>WhatsApp</p></div><div class="icon"><i class="fab fa-whatsapp"></i></div></div></div>
    <div class="col-lg-2 col-6"><div class="small-box bg-danger"><div class="inner"><h3>${nbAppels}</h3><p>Appels</p></div><div class="icon"><i class="fas fa-phone"></i></div></div></div>
    <div class="col-lg-2 col-6"><div class="small-box bg-pink"><div class="inner"><h3>${nbLikes}</h3><p>Jâ€™aime</p></div><div class="icon"><i class="fas fa-heart"></i></div></div></div>`;
}

// ---------------- Affichage annonces ----------------
function renderAnnonces(){
  const container = document.getElementById("annoncesList");
  container.innerHTML = "";
  annonces.forEach((a,index)=>{
    let carouselId = `carousel${index}`;
    let carouselInner = a.images.map((img,i)=>`<div class="carousel-item ${i===0?'active':''}"><img src="${img}" class="d-block w-100"></div>`).join("");
    container.innerHTML += `
      <div class="col-md-4 mb-3">
        <div class="card shadow-sm">
          <div id="${carouselId}" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">${carouselInner}</div>
            <button class="carousel-control-prev" type="button" data-bs-target="#${carouselId}" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
            <button class="carousel-control-next" type="button" data-bs-target="#${carouselId}" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
          </div>
          <div class="card-body">
            <h5>${a.titre} - $${a.prix}</h5>
            <p>ğŸ“ ${a.ville} | ğŸ  ${a.chambres} chambres, ğŸš¿ ${a.sdb}, ğŸ³ ${a.cuisine}<br>ğŸ“… ${a.date}</p>
            <div class="d-flex align-items-center my-2"><img src="${a.imgProprietaire}" width="40" height="40" class="rounded-circle me-2">${a.nomProprietaire}</div>
            <a href="#" class="btn btn-success btn-sm me-1" onclick="addInteraction(${index},'whatsapp')">WhatsApp</a>
            <a href="#" class="btn btn-primary btn-sm me-1" onclick="addInteraction(${index},'appel')">ğŸ“ Appel</a>
            <button class="btn btn-danger btn-sm me-1" onclick="supprimerAnnonce(${index})">ğŸ—‘ Supprimer</button>
            <button class="btn btn-pink btn-sm" onclick="addInteraction(${index},'like')">â¤ï¸ Jâ€™aime</button>
          </div>
        </div>
      </div>`;
  });
  renderStats();
  renderInteractions();
}

// ---------------- Interactions ----------------
function addInteraction(index,type){
  const a = annonces[index];
  interactions.push({id:interactions.length+1,annonce:a.titre,type:type,date:new Date().toLocaleString()});
  localStorage.setItem("interactions",JSON.stringify(interactions));
  renderInteractions();
}

function renderInteractions(){
  const tbody = document.querySelector("#tableInteractions tbody");
  tbody.innerHTML = "";
  interactions.forEach(i=>{
    tbody.innerHTML += `<tr><td>${i.id}</td><td>${i.annonce}</td><td>${i.type}</td><td>${i.date}</td></tr>`;
  });
}

// ---------------- Ajouter / Supprimer ----------------
document.getElementById("annonceForm").addEventListener("submit", function(e){
  e.preventDefault();
  // CrÃ©ation de l'objet annonce
  const a = {
    titre: document.getElementById("titre").value,
    prix: document.getElementById("prix").value,
    ville: document.getElementById("ville").value,
    chambres: document.getElementById("chambres").value,
    sdb: document.getElementById("sdb").value,
    cuisine: document.getElementById("cuisine").value,
    date: document.getElementById("date").value,
    nomProprietaire: document.getElementById("nomProprietaire").value,
    imgProprietaire: document.getElementById("imgProprietaire").value,
    images: document.getElementById("images").value.split(",").map(img=>img.trim())
  };
  // Ajout dans la liste des annonces
  annonces.push(a);
  localStorage.setItem("annonces", JSON.stringify(annonces));
  // Reset du formulaire
  this.reset();
  // Re-render du dashboard
  renderAnnonces();
});

// Suppression d'une annonce
function supprimerAnnonce(index){
  // Retirer l'annonce
  annonces.splice(index,1);
  localStorage.setItem("annonces", JSON.stringify(annonces));
  // Supprimer les interactions liÃ©es Ã  cette annonce
  interactions = interactions.filter(i => i.annonce !== annonces[index]?.titre);
  localStorage.setItem("interactions", JSON.stringify(interactions));
  // Re-render dashboard
  renderAnnonces();
}

// Render initial
renderAnnonces();
</script>
</body>
</html>
